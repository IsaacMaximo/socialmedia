<!DOCTYPE html>
<html>
<head>
    <title>Autenticação Spotify</title>
    <script type="module">
        import { exchangeCodeForToken } from '/js/auth/OAuth.js';
        
        async function handleCallback() {
            try {
                const params = new URLSearchParams(window.location.search);
                const code = params.get('code');
                const error = params.get('error');
                
                if (error) {
                    throw new Error(`Erro do Spotify: ${error}`);
                }
                
                if (code) {
                    await exchangeCodeForToken(code);
                    window.opener.postMessage('authSuccess', window.location.origin);
                    window.close();
                } else {
                    throw new Error('Código de autorização não encontrado');
                }
            } catch (error) {
                console.error('Erro no callback:', error);
                window.opener.postMessage('authError', window.location.origin);
                document.getElementById('message').textContent = 'Erro na autenticação. Feche esta janela e tente novamente.';
            }
        }
        
        document.addEventListener('DOMContentLoaded', handleCallback);
    </script>
</head>
<body>
    <div id="message">Processando autenticação...</div>
</body>
</html>